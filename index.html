<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
<link href="https://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.0/socket.io.slim.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/screenfull.js/3.3.2/screenfull.min.js"></script>
<script>
  const socket = io();

  const state = {};

  socket.on('init', (data) => {
    console.log('init', data);
  });

  function emitAction(action) {
    console.log('action', action);
    socket.emit('action', action);

    state.action = action;
  }

  window.onload = () => {
    const fullscreen = document.getElementById('fullscreen');
    const surface = document.getElementById('surface');

    function resize() {
      surface.width = surface.clientWidth;
      surface.height = surface.clientHeight;
    }

    window.addEventListener('resize', resize);

    resize();

    if (screenfull.enabled) {
      fullscreen.addEventListener('click', () => {
        fullscreen.parentNode.removeChild(fullscreen);
        screenfull.request(surface);
      });
    }

    const hammertime = new Hammer(surface, {});

    hammertime.on('tap', (evt) => {
      const normX = evt.center.x / surface.clientWidth;
      const normY = evt.center.y / surface.clientHeight;

      if (Math.abs(normY - 0.5) < 0.25 && Math.abs(normX - 0.5) > 0.25) {
        if (normX < 0.5) {
          emitAction('left');
        } else {
          emitAction('right');
        }
      }
    });

    const ctx = surface.getContext('2d');

    function paint() {
      requestAnimationFrame(paint);

      ctx.fillStyle = 'black';
      ctx.fillRect(0, 0, surface.width, surface.height);

      switch (state.action) {
      case 'left':
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, surface.width / 2, surface.height);
        break;
      case 'right':
        ctx.fillStyle = 'white';
        ctx.fillRect(surface.width / 2, 0, surface.width / 2, surface.height);
        break;
      }
    }

    requestAnimationFrame(paint);
  };
</script>
<style>
html, body {
  height: 100%;
}
body {
  margin: 0;
  padding: 0;
  position: relative;
  font-family: 'Varela Round', sans-serif;
  overflow: hidden;
}
#surface {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
#fullscreen {
  position: absolute;
  font-size: 1em;
  line-height: 10em;
  font-weight: bold;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  padding: 1em;
  box-sizing: border-box;
  color: white;
  text-align: center;
  cursor: pointer;
}
</style>
</head>
<body>
<canvas id="surface"></canvas>
<div id="fullscreen">Tap to enter fullscreen</div>
</body>
</html>
